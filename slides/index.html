<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Introduction à Spring MVC</title>

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/solarized.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="atom-one-light.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<style>
			.reveal .main-title {
                /* Empty */
			}

			.reveal .chapter {
                /* Empty */
			}

            .reveal .center {
                text-align: center;
            }

            .reveal .chapter h2 {
                font-size: 5em;
            }

			.reveal .slides img {
				border: none;
				background: none;
				box-shadow: none;
				height: auto;
			}

            .reveal .slides {
                font-size: 30px;
            }

			.reveal .slide-background.present {
				opacity: 0.1;
			}

            .reveal .slide {
				text-align: left;
			}

            .reveal pre {
                width: 100%;
            }

			.reveal code {
                /*font-size: 70%;*/
                line-height: 22px;
			}

			.reveal pre code {
                max-height: none;
			}
		</style>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section class="main-title">
					<h1>Introduction à Spring MVC</h1>
					<h3>Formation des développeurs</h3>
					<p>
						<small>Romain Warnan</small>
					</p>
					<table>
						<tr>
							<td><img src="../images/spring.png" style="width: 100px;" /></td>
							<td><img src="../images/java-8.png" style="width: 100px;" /></td>
							<td><img src="../images/maven.png" style="width: 100px;" /></td>
							<td><img src="../images/tomcat.png" style="width: 100px;" /></td>
							<td><img src="../images/ajax.png" style="width: 100px;" /></td>
							<td><img src="../images/github.png" style="width: 100px;" /></td>
							<td><img src="../images/jquery.png" style="width: 100px;" /></td>
						</tr>
					</table>
				</section>

                <!-- Chapitre 1 -->

				<section data-markdown data-background-image="../images/spring.png" data-background-size="1200px" class="chapter">
					## 1
					### Spring core : rappels
				</section>
				<section data-markdown class="slide">
					### Spring core
					Spring core : conteneur qui implémente le *pattern* «&nbsp;inversion de contrôle&nbsp;» (IoC)

					Définitions des objets (*bean*)
					 - XML : `applicationContext.xml`

					 - Annotations
					  - Stéréotypes : `@Component`, `@Service`, `@Repository`, `@Controller`…
					  - Injection : `@Autowired`, `@Resource`, `@Value`…
					  - Configuration : `@Configuration`
				</section>
				<section data-markdown class="slide">
					### Spring core
					Au démarrage de l’application, chargement du contexte
					Web : *listener*
					```xml
					&lt;context-param&gt;
						&lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
						&lt;param-value&gt;classpath:applicationContext.xml&lt;/param-value&gt;
					&lt;/context-param&gt;
					&lt;listener&gt;
						&lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;
					&lt;/listener&gt;
					```
					Batch : de manière explicite en Java
					```java
					try(AbstractApplicationContext context = new ClassPathXmlApplicationContext("applicationContext.xml")){
						Service service1 = (Service) context.getBean("beanName");
						Service service2 = context.getBean(Service.class);
						Service service3 = context.getBean("beanName", Service.class);
					}
					```
				</section>
				<section data-markdown class="slide">
					### Beans et injection des dépendances
					En XML
					```xml
					&lt;bean id="cacheManager" class="org.springframework.cache.ehcache.EhCacheCacheManager"&gt;
						&lt;property name="cacheManager" ref="ehcache" /&gt;
					&lt;/bean&gt;
					&lt;bean id="ehcache" class="org.springframework.cache.ehcache.EhCacheManagerFactoryBean"&gt;
						&lt;property name="configLocation" value="classpath:ehcache.xml" /&gt;
					&lt;/bean&gt;
					```
				</section>
				<div class="slides">
					<section>
						<section data-markdown class="slide">
							### Beans et injection des dépendances
							Par annotation, version `@Autowired`
							```java
							@Repository
							public class AdresseDaoImpl implements AdresseDao {
							```
							```java
							@Service
							public class AdresseServiceImpl implements AdresseService {

							@Autowired
							private AdresseDao adresseDao;
							```
							Par annotation, version `@Resource`
							```java
							@Repository("adresseDao1")
							public class AdresseDaoImpl implements AdresseDao {
							```
							```java
							@Service
							public class AdresseServiceImpl implements AdresseService {

							@Resource(name = "adresseDao1")
							private AdresseDao adresseDao;
							```
						</section>
						<section data-markdown class="slide">
							### Activer la détection des annotations
							```xml
							&lt;context:component-scan base-package="fr.insee" /&gt;
							```
						</section>
						<section data-markdown class="slide">
							### Injection d’une source de propriétés
							Pour externaliser des propriétés non surchargeables par le C.E.I.
							<small>Sinon, utiliser `InseeConfig`</small>
							```
							prefix.key.a=Valeur A
							prefix.key.b=Valeur B
							```
							```java
							@Component
							@PropertySource("classpath:application.properties")
							public class ComponentImpl {

							@Value("${prefix.key.a}")
							private String a;
							```
						</section>
					</section>
				</div>

                <!-- Chapitre 2 -->

                <section data-markdown data-background-image="../images/spring.png" data-background-size="1200px" class="chapter">
                    ## 2
                    ### Spring MVC : généralités
                </section>
                <section class="slide">
                    <h3>Classement des frameworks web en 2017</h3>
                    <div class="center">
                        <img src="../images/web-frameworks.png" style="width: 600px" />
                    </div>
                </section>
                <section data-markdown class="slide">
                    ### Dépendances Maven
                    ```xml
                    &lt;dependency&gt;
                        &lt;groupId&gt;org.springframework&lt;/groupId&gt;
                        &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;
                        &lt;version&gt;${spring.version}&lt;/version&gt;
                    &lt;/dependency&gt;
                    &lt;dependency&gt;
                        &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
                        &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;
                        &lt;version&gt;3.1.0&lt;/version&gt;
                        &lt;scope&gt;provided&lt;/scope&gt;
                    &lt;/dependency&gt;
                    &lt;dependency&gt;
                        &lt;groupId&gt;javax.servlet.jsp&lt;/groupId&gt;
                        &lt;artifactId&gt;jsp-api&lt;/artifactId&gt;
                        &lt;version&gt;2.2&lt;/version&gt;
                        &lt;scope&gt;provided&lt;/scope&gt;
                    &lt;/dependency&gt;
                    &lt;dependency&gt;
                        &lt;groupId&gt;jstl&lt;/groupId&gt;
                        &lt;artifactId&gt;jstl&lt;/artifactId&gt;
                        &lt;version&gt;1.2&lt;/version&gt;
                    &lt;/dependency&gt;
                    ```
                </section>
                <section class="slide">
                    <h3>Modèle MVC</h3>
                    <p>Modèle &ndash; Vue &ndash; Contrôleur</p>
                    <div class="center">
                        <img src="../images/modele-mvc.png" style="width: 1000px" />
                    </div>
                </section>
                <section data-markdown class="slide">
                    ### Le contrôleur frontal : ServletDispatcher
                    Toutes les requêtes sont interceptées par la même servlet

                    ServletDispatcher, fournie par Spring MVC

                     1. intercepte la requête
                     2. délègue la requête au contrôleur adéquat
                     3. récupère le modèle
                     4. transmet le modèle au générateur de vue
                     5. récupère la vue générée
                     6. retourne la réponse au client

                    La servlet possède son propre contexte Spring
                </section>
                <section data-markdown class="slide">
                    ### Déclarer la servlet ServletDispatcher

                    ```xml
                    &lt;servlet&gt;
                        &lt;servlet-name&gt;servlet-dispatcher&lt;/servlet-name&gt;
                        &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
                        &lt;init-param&gt;
                            &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
                            &lt;param-value&gt;classpath:servlet-dispatcher.xml&lt;/param-value&gt;
                        &lt;/init-param&gt;
                        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
                    &lt;/servlet&gt;
                    &lt;servlet-mapping&gt;
                        &lt;servlet-name&gt;servlet-dispatcher&lt;/servlet-name&gt;
                        &lt;url-pattern&gt;/&lt;/url-pattern&gt;
                    &lt;/servlet-mapping&gt;
                    ```

                    Attention : « / » et pas « /* »
                </section>
			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
            Reveal.configure({
				slideNumber: 'c/t',
				history: true,
			});
		</script>
	</body>
</html>
         kk